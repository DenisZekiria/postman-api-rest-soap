{
	"info": {
		"_postman_id": "3a58c0e1-e48a-4927-a7d3-b5c5b7590177",
		"name": "Mobile Login, Create, Edit and Delete new Sale",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "31395851"
	},
	"item": [
		{
			"name": "Login",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							"// Parse the response body as JSON\r",
							"var responseBody = pm.response.json();\r",
							"\r",
							"// Extract the access_token from the response body\r",
							"var accessToken = responseBody.access_token;\r",
							"\r",
							"// Set the access_token as a global variable\r",
							"pm.collectionVariables.set('access_token', responseBody.access_token);"
						],
						"type": "text/javascript",
						"packages": {}
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "grant_type",
							"value": "password",
							"type": "text"
						},
						{
							"key": "username",
							"value": "denis",
							"type": "text"
						},
						{
							"key": "password",
							"value": "1111",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{BaseURL}}/Users/login",
					"host": [
						"{{BaseURL}}"
					],
					"path": [
						"Users",
						"login"
					]
				}
			},
			"response": []
		},
		{
			"name": "Login Me",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});"
						],
						"type": "text/javascript",
						"packages": {}
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				}
			],
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{access_token}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [],
				"body": {
					"mode": "urlencoded",
					"urlencoded": []
				},
				"url": {
					"raw": "{{BaseURL}}/Users/me",
					"host": [
						"{{BaseURL}}"
					],
					"path": [
						"Users",
						"me"
					]
				}
			},
			"response": []
		},
		{
			"name": "Create new Sale - first part",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							"pm.test(\"Parse Response and Save Variables\", function () {\r",
							"  var responseBody = pm.response.json();\r",
							"  var result = responseBody.result;\r",
							"\r",
							"  // Extract and save desired values\r",
							"  pm.collectionVariables.set(\"saleType\", result.type);\r",
							"  pm.collectionVariables.set(\"receiptCompanyName\", result.receiptCompanyName);\r",
							"  pm.collectionVariables.set(\"receiptNumber\", result.receiptCompanyName);\r",
							"  pm.collectionVariables.set(\"carrierName\", result.carrierName);\r",
							"  pm.collectionVariables.set(\"SaleReceiptDate\", result.receiptDate);\r",
							"  pm.collectionVariables.set(\"receiptType\", result.receiptType);\r",
							"  pm.collectionVariables.set(\"fiscalDocumentStatus\", result.fiscalDocumentStatus);\r",
							"  pm.collectionVariables.set(\"SaleId\", result.id);\r",
							"  pm.collectionVariables.set(\"number\", result.number);\r",
							"  pm.collectionVariables.set(\"note\", result.note);\r",
							"  pm.collectionVariables.set(\"ownerName\", result.ownerName);\r",
							"  pm.collectionVariables.set(\"fiscalNumber\", result.fiscalNumber);\r",
							"  pm.collectionVariables.set(\"SaleCreated\", result.created);\r",
							"  pm.collectionVariables.set(\"SaleModified\", result.modified);\r",
							"  pm.collectionVariables.set(\"accessState\", result.accessState);\r",
							"\r",
							"  var conversionRate = result.rates.find(function(rate) {\r",
							"    return rate.source === \"M\" && rate.target === \"L\";\r",
							"  }).conversionRate;\r",
							"  pm.collectionVariables.set(\"conversionRateMtoL\", conversionRate);\r",
							"\r",
							"  pm.expect(responseBody.result.type).to.eql(\"Sale\");\r",
							"});\r",
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{access_token}}",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\r\n    \"receiptCompanyName\": \"TEST_DENIS\",\r\n    \"receiptType\": \"None\"\r\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{BaseURL}}/SaleDocuments",
					"host": [
						"{{BaseURL}}"
					],
					"path": [
						"SaleDocuments"
					]
				}
			},
			"response": []
		},
		{
			"name": "Create new Sale - second part",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{access_token}}",
							"type": "string"
						}
					]
				},
				"method": "PUT",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\r\n    \"items\": [\r\n        {\r\n            \"documentType\": \"{{saleType}}\",\r\n            \"paymentDueDate\": \"{{paymentDueDate}}\",\r\n            \"paidQuantity\": 0.0,\r\n            \"returnedQuantity\": 0.0,\r\n            \"number\": 1,\r\n            \"position\": 0,\r\n            \"warehouseName\": \"Освновен\",\r\n            \"groupName\": \"Тест\",\r\n            \"articleName\": \"вода\",\r\n            \"batchName\": null,\r\n            \"quantity\": 1.0,\r\n            \"secondaryQuantity\": 0.0,\r\n            \"discount\": 5.00,\r\n            \"vat\": 20.0,\r\n            \"register\": {\r\n                \"id\": 0,\r\n                \"name\": \"Стандартна каса\",\r\n                \"type\": \"Cash\",\r\n                \"contact\": null,\r\n                \"isDefault\": false\r\n            },\r\n            \"paymentType\": \"Cash\",\r\n            \"properties\": [],\r\n            \"price\": 3.420,\r\n            \"currencyId\": \"L\",\r\n            \"currency\": {\r\n                \"id\": \"L\",\r\n                \"currencyFormat\": \"{0:0.00} лв.\",\r\n                \"symbol\": \"лв.\",\r\n                \"name\": \"Български лев\"\r\n            },\r\n            \"note\": null,\r\n            \"articleDefinition\": {\r\n                \"code\": \"\",\r\n                \"barcode\": \"\",\r\n                \"parcelling\": \"бр.\",\r\n                \"secondaryParcelling\": \"\"\r\n            },\r\n            \"priceList\": \"Специални цени\",\r\n            \"priceListType\": \"Special\",\r\n            \"documentId\": {{SaleId}},\r\n            \"documentNumber\": null,\r\n            \"documentCreated\": null,\r\n            \"basePrice\": 3.0\r\n        }\r\n    ],\r\n    \"receiptCompanyName\": \"{{receiptCompanyName}}\",\r\n    \"receiptNumber\": \"{{receiptNumber}}\",\r\n    \"receiptDate\": \"{{SaleReceiptDate}}\",\r\n    \"receiptType\": \"{{receiptType}}\",\r\n    \"agentName\": \"{{agentName}}\",\r\n    \"carrierName\": \"{{carrierName}}\",\r\n    \"fiscalDocumentStatus\": \"{{fiscalDocumentStatus}}\",\r\n    \"id\": {{SaleId}},\r\n    \"fiscalNumber\": \"{{fiscalNumber}}\",\r\n    \"created\": \"{{SaleCreated}}\",\r\n    \"modified\": \"{{SaleModified}}\",\r\n    \"number\": \"{{number}}\",\r\n    \"customerName\": \"1\",\r\n    \"note\": \"{{note}}\",\r\n    \"properties\": [],\r\n    \"rates\": [],\r\n    \"accessState\": \"{{accessState}}\"\r\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{BaseURL}}/SaleDocuments",
					"host": [
						"{{BaseURL}}"
					],
					"path": [
						"SaleDocuments"
					]
				}
			},
			"response": []
		},
		{
			"name": "Edit Note on the new Sale - first part",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{access_token}}",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\r\n    \"items\": [\r\n        {\r\n            \"documentType\": \"{{saleType}}\",\r\n            \"paymentDueDate\": \"{{paymentDueDate}}\",\r\n            \"paidQuantity\": 0.0,\r\n            \"returnedQuantity\": 0.0,\r\n            \"number\": 1,\r\n            \"position\": 0,\r\n            \"warehouseName\": \"Освновен\",\r\n            \"groupName\": \"Тест\",\r\n            \"articleName\": \"вода\",\r\n            \"batchName\": null,\r\n            \"quantity\": 1.0,\r\n            \"secondaryQuantity\": 0.0,\r\n            \"discount\": 5.00,\r\n            \"vat\": 20.0,\r\n            \"register\": {\r\n                \"id\": 0,\r\n                \"name\": \"Стандартна каса\",\r\n                \"type\": \"Cash\",\r\n                \"contact\": null,\r\n                \"isDefault\": false\r\n            },\r\n            \"paymentType\": \"Cash\",\r\n            \"properties\": [],\r\n            \"price\": 3.420,\r\n            \"currencyId\": \"L\",\r\n            \"currency\": {\r\n                \"id\": \"L\",\r\n                \"currencyFormat\": \"{0:0.00} лв.\",\r\n                \"symbol\": \"лв.\",\r\n                \"name\": \"Български лев\"\r\n            },\r\n            \"note\": null,\r\n            \"articleDefinition\": {\r\n                \"code\": \"\",\r\n                \"barcode\": \"\",\r\n                \"parcelling\": \"бр.\",\r\n                \"secondaryParcelling\": \"\"\r\n            },\r\n            \"priceList\": \"Специални цени\",\r\n            \"priceListType\": \"Special\",\r\n            \"documentId\": {{SaleId}},\r\n            \"documentNumber\": null,\r\n            \"documentCreated\": null,\r\n            \"basePrice\": 3.0\r\n        }\r\n    ],\r\n    \"receiptCompanyName\": \"{{receiptCompanyName}}\",\r\n    \"receiptNumber\": \"{{receiptNumber}}\",\r\n    \"receiptDate\": \"{{receiptDate}}\",\r\n    \"receiptType\": \"{{receiptType}}\",\r\n    \"agentName\": \"{{agentName}}\",\r\n    \"carrierName\": \"{{carrierName}}\",\r\n    \"fiscalDocumentStatus\": \"{{fiscalDocumentStatus}}\",\r\n    \"id\": {{SaleId}},\r\n    \"fiscalNumber\": \"{{fiscalNumber}}\",\r\n    \"created\": \"{{created}}\",\r\n    \"modified\": \"{{modified}}\",\r\n    \"number\": \"{{number}}\",\r\n    \"customerName\": \"1\",\r\n    \"note\": \"{{note}}\",\r\n    \"properties\": [],\r\n    \"rates\": [],\r\n    \"accessState\": \"{{accessState}}\"\r\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{BaseURL}}/SaleDocuments/{{SaleId}}/lock?force=False",
					"host": [
						"{{BaseURL}}"
					],
					"path": [
						"SaleDocuments",
						"{{SaleId}}",
						"lock"
					],
					"query": [
						{
							"key": "force",
							"value": "False"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Edit Note on the new Sale - second part",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{access_token}}",
							"type": "string"
						}
					]
				},
				"method": "PUT",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\r\n    \"items\": [\r\n        {\r\n            \"documentType\": \"Sale\",\r\n            \"paymentDueDate\": null,\r\n            \"paidQuantity\": 1.0,\r\n            \"returnedQuantity\": 0.0,\r\n            \"position\": 1,\r\n            \"secondaryQuantity\": 0.0,\r\n            \"discount\": 5.0,\r\n            \"vat\": 20.0,\r\n            \"register\": {\r\n                \"id\": 0,\r\n                \"name\": \"Стандартна каса\",\r\n                \"type\": \"Cash\",\r\n                \"contact\": null,\r\n                \"isDefault\": true\r\n            },\r\n            \"paymentType\": \"Cash\",\r\n            \"properties\": [],\r\n            \"price\": 3.42,\r\n            \"currencyId\": \"L\",\r\n            \"currency\": {\r\n                \"id\": \"L\",\r\n                \"currencyFormat\": \"{0:0.00} лв.\",\r\n                \"symbol\": \"лв.\",\r\n                \"name\": \"Български лев\"\r\n            },\r\n            \"priceList\": \"Специални цени\",\r\n            \"priceListType\": \"Special\",\r\n            \"basePrice\": 3.0,\r\n            \"number\": 1,\r\n            \"warehouseName\": \"Освновен\",\r\n            \"groupName\": \"Тест\",\r\n            \"articleName\": \"вода\",\r\n            \"batchName\": \"\",\r\n            \"quantity\": 1.0,\r\n            \"note\": \"\",\r\n            \"documentId\": 8780830,\r\n            \"articleDefinition\": {\r\n                \"articleName\": null,\r\n                \"groupName\": null,\r\n                \"code\": \"0\",\r\n                \"barcode\": \"\",\r\n                \"parcelling\": \"бр.\",\r\n                \"secondaryParcelling\": \"\",\r\n                \"secondaryParcellingRelator\": null\r\n            },\r\n            \"wmsDocument\": null\r\n        }\r\n    ],\r\n    \"receiptCompanyName\": \"TEST_DENIS\",\r\n    \"receiptNumber\": \"\",\r\n    \"receiptDate\": \"{{receiptDate}}\",\r\n    \"receiptType\": \"{{receiptType}}\",\r\n    \"agentName\": \"{{agentName}}\",\r\n    \"carrierName\": \"{{carrierName}}\",\r\n    \"fiscalDocumentStatus\": \"{{fiscalDocumentStatus}}\",\r\n    \"fiscalNumber\": \"{{fiscalNumber}}\",\r\n    \"customerName\": \"1\",\r\n    \"properties\": [],\r\n    \"rates\": [\r\n        {\r\n            \"source\": \"M\",\r\n            \"target\": \"L\",\r\n            \"conversionRate\": 0.0\r\n        },\r\n        {\r\n            \"source\": \"$\",\r\n            \"target\": \"L\",\r\n            \"conversionRate\": 0.0\r\n        },\r\n        {\r\n            \"source\": \"$\",\r\n            \"target\": \"M\",\r\n            \"conversionRate\": 0.0\r\n        },\r\n        {\r\n            \"source\": \"1\",\r\n            \"target\": \"L\",\r\n            \"conversionRate\": 0.0\r\n        },\r\n        {\r\n            \"source\": \"2\",\r\n            \"target\": \"L\",\r\n            \"conversionRate\": 0.0\r\n        },\r\n        {\r\n            \"source\": \"3\",\r\n            \"target\": \"L\",\r\n            \"conversionRate\": 0.0\r\n        },\r\n        {\r\n            \"source\": \"4\",\r\n            \"target\": \"L\",\r\n            \"conversionRate\": 0.0\r\n        },\r\n        {\r\n            \"source\": \"5\",\r\n            \"target\": \"L\",\r\n            \"conversionRate\": 0.0\r\n        }\r\n    ],\r\n    \"id\": {{SaleId}},\r\n    \"created\": \"{{created}}\",\r\n    \"modified\": \"{{modified}}\",\r\n    \"number\": \"0000000076\",\r\n    \"note\": \"EDIT-NOTE-AUTO\",\r\n    \"ownerName\": \"{{ownerName}}\",\r\n    \"open\": false,\r\n    \"accessState\": \"FullControl\"\r\n}\r\n",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{BaseURL}}/SaleDocuments",
					"host": [
						"{{BaseURL}}"
					],
					"path": [
						"SaleDocuments"
					]
				}
			},
			"response": []
		},
		{
			"name": "Delete the new Sale",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							"pm.test(\"Response Body compare\", function () {\r",
							"    const responseData = pm.response.json();\r",
							"    pm.expect(responseData.isError).to.be.false;\r",
							"    pm.expect(responseData.result).to.be.true;\r",
							"});\r",
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{access_token}}",
							"type": "string"
						}
					]
				},
				"method": "DELETE",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{BaseURL}}/SaleDocuments/{{SaleId}}",
					"host": [
						"{{BaseURL}}"
					],
					"path": [
						"SaleDocuments",
						"{{SaleId}}"
					]
				}
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "BaseURL",
			"value": "YOUR_IP_AND_PORT/mobile",
			"type": "string"
		},
		{
			"key": "access_token",
			"value": ""
		},
		{
			"key": "saleType",
			"value": ""
		},
		{
			"key": "receiptCompanyName",
			"value": ""
		},
		{
			"key": "receiptNumber",
			"value": ""
		},
		{
			"key": "carrierName",
			"value": ""
		},
		{
			"key": "receiptType",
			"value": ""
		},
		{
			"key": "fiscalDocumentStatus",
			"value": ""
		},
		{
			"key": "number",
			"value": ""
		},
		{
			"key": "note",
			"value": ""
		},
		{
			"key": "ownerName",
			"value": ""
		},
		{
			"key": "fiscalNumber",
			"value": ""
		},
		{
			"key": "accessState",
			"value": ""
		},
		{
			"key": "conversionRateMtoL",
			"value": ""
		},
		{
			"key": "SaleId",
			"value": ""
		},
		{
			"key": "SaleReceiptDate",
			"value": ""
		},
		{
			"key": "SaleCreated",
			"value": ""
		},
		{
			"key": "SaleModified",
			"value": ""
		}
	]
}